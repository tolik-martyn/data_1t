### Название и общее описание проекта.

**Проект № 5 «Служба такси».**

Есть таблица, состоящая из поездок такси в Нью-Йорке.

Необходимо, используя таблицу поездок для каждого дня, рассчитать процент поездок по количеству человек в машине (без пассажиров, 1, 2, 3, 4 и более пассажиров). По итогу должна получиться таблица (`parquet`) с колонками `date`, `percentage_zero`, `percentage_1p`, `percentage_2p`, `percentage_3p`, `percentage_4p_plus`. Технологический стек — sql, scala (что-то одно).
Также добавить столбцы к предыдущим результатам с самой дорогой и самой дешевой поездкой для каждой группы.

Дополнительно: также провести аналитику и построить график на тему «Как пройденное расстояние и количество пассажиров влияет на чаевые» в любом удобном инструменте.

Результат выполнения задания необходимо выложить в github/gitlab и указать ссылку на Ваш репозиторий (не забудьте: репозиторий должен быть публичным).

---

### Цели проекта с описанием бизнес-задачи и требованиями.

**Цели проекта:**
1. **Рассчет процента поездок по количеству пассажиров:** Основной целью проекта является определение процента поездок в зависимости от количества человек в машине (без пассажиров, 1, 2, 3, 4 и более). Это позволит оценить динамику использования такси с различным числом пассажиров.

2. **Создание таблицы результатов в формате parquet:** Поставленная задача требует формирования структурированной таблицы с результатами анализа в формате parquet. Этот формат обеспечит оптимальное хранение данных, что важно для последующей работы с ними и обеспечения производительности.

3. **Добавление данных о самой дорогой и самой дешевой поездке:** Дополнительной целью является расширение результатов анализа путем добавления информации о самой дорогой и самой дешевой поездке для каждой группы пассажиров. Это позволит выделить крайние значения и провести дополнительный анализ экстремальных случаев.

4. **Аналитика и визуализация:** Дополнительно к основной задаче, проект включает в себя проведение аналитики и построение графика на тему «Как пройденное расстояние и количество пассажиров влияет на чаевые». Это позволит выявить взаимосвязи между факторами и оценить влияние параметров поездок на размер чаевых.

**Бизнес-задача:**
Бизнес-задачей проекта является получение структурированных данных, позволяющих понять паттерны и тенденции в использовании такси в зависимости от количества пассажиров, а также выявление факторов, влияющих на размер чаевых. Эта информация может быть использована для оптимизации сервиса такси, адаптации тарифов и улучшения качества обслуживания.

**Требования к проекту:**
1. **Точность анализа:** Результаты анализа должны быть максимально точными и репрезентативными, что обеспечит правильные выводы и рекомендации для бизнеса.

2. **Эффективность обработки данных:** Обработка данных должна быть произведена эффективно, учитывая их значительный объем. Это позволит оптимизировать время выполнения проекта.

3. **Читаемость кода и документация:** Код должен быть написан читаемо и поддерживаемо, а документация к проекту должна включать в себя подробные пояснения и комментарии.

4. **Гибкость анализа:** Решение должно обеспечивать гибкость анализа, позволяя легко вносить изменения и дополнения в случае появления новых требований или вопросов.

5. **Визуализация результатов:** Построение графика по влиянию пройденного расстояния и количества пассажиров на чаевые должно быть реализовано в инструменте визуализации, обеспечивающем понятность и наглядность результатов.

Этот проект направлен на получение важных данных для бизнеса, которые будут использованы для оптимизации услуги такси и улучшения качества обслуживания.

---

### План реализации.

1. **Настройка инфраструктуры:**
- Создал файл [docker-compose.yml](docker-compose.yml) для настройки контейнеров с PostgreSQL и приложением для анализа данных.
- Определил переменные окружения и параметры контейнеров.

2. **Подготовка данных:**
- Написал SQL-скрипты в директории [init/](init) для создания таблиц и загрузки данных в базу.
- Использовал скрипты для создания таблиц [raw_data](init%2F1_raw_data.sql), [core_data](init%2F2_core_data.sql), [percentage_max_min_data](init%2F3_%20percentage_max_min_data.sql) и [tip_data](init%2F4_tip_data.sql).

3. **Разработка приложения для анализа данных:**
- Создал [Docker-образ](app%2FDockerfile) для приложения на основе Python 3.9.
- Реализовал первичный анализ данных в файле [primary_analysis.py](app%2Fprimary_analysis.py).
- Реализовал скрипт [script.py](app%2Fscript.py) для извлечения данных из базы и визуализации результатов.

4. **Визуализация и анализ:**
- Использовал библиотеки pandas, psycopg2, matplotlib, seaborn для обработки данных и визуализации результатов анализа.
- Визуализировал структуру проекта и хранилища данных.

5. **Результаты:**
- В директории [result/](result) расположены файлы с результатами анализа данных и структурой проекта.
- Полученные результаты сохранены в формате Parquet и изображения.

---

### Используемые технологии.

Для решения поставленной задачи я выбрал Pandas с Python и PostgreSQL по нескольким ключевым причинам.

1. **Простота использования и гибкость Pandas:**
   - Pandas с Python предоставляет удобный и интуитивно понятный синтаксис для манипуляций с данными. Это особенно важно, учитывая, что я должен провести агрегацию данных по количеству пассажиров, вычислить проценты и анализировать результаты. Я хотел выбрать инструмент, который позволял бы мне легко и эффективно работать с данными, и Pandas полностью соответствует этим требованиям.

2. **Эффективность SQL-запросов в PostgreSQL:**
   - PostgreSQL предоставляет мощные средства языка SQL, что является необходимым для проведения агрегаций, фильтраций и расчетов статистики по данным. Учитывая, что задача включает в себя сложные запросы и анализ данных, использование реляционной базы данных с поддержкой SQL предоставляет надежный и эффективный способ хранения и получения данных.

Существует несколько причин, почему я не выбрал Apache Spark или Hive и Hadoop:

1. **Сложность настройки и использования:**
   - Apache Spark и Hadoop являются мощными инструментами для обработки больших объемов данных, но они также требуют сложной настройки и управления кластером. В моем случае, где размер данных не настолько велик, использование этих технологий могло бы быть избыточным и сложным в настройке для относительно простой задачи.

2. **Использование реляционной структуры данных:**
   - Моя задача включает анализ данных по относительно простым критериям, таким как количество пассажиров и дни. Использование SQL в PostgreSQL с легкостью позволяет выполнить необходимые операции агрегации и фильтрации, а реляционная структура базы данных лучше соответствует характеру моих данных.

3. **Требования к ресурсам:**
   - Apache Spark и Hadoop требуют значительных ресурсов, и их использование оправдано в случае обработки больших объемов данных на кластере серверов. В данном случае, где объем данных не является критически большим, Pandas с Python и PostgreSQL предоставляют более легкое и простое в настройке решение.

---

### Схемы и архитектуры.

**Структура проекта:**

![project-structure.png](result%2Fproject-structure.png)

**Структура хранилища данных:**

![taxi-ride.png](result/taxi-ride.png)

---

### Результаты разработки.

1. **Структура проекта:**
   - Разработал структуру проекта.

2. **Хранилище данных:**
   - Предоставил схему хранилища данных.

3. **Анализ поездок:**
   - Провел первичный анализ данных из файла `yellow_tripdata_2020-01.csv`.
   - Создал и запустил SQL-скрипты для агрегации данных и создания таблиц `percentage_max_min_data` и `tip_data`.

4. **Визуализация результатов:**
   - Разработал скрипт [script.py](app%2Fscript.py) для извлечения данных из базы и создания визуализаций.

5. **График на тему «Как пройденное расстояние и количество пассажиров влияет на чаевые»:**

![tip_data.png](result%2Ftip_data.png)

---

### Выводы на основе данных из таблицы `tip_data`:

1. **Общие тенденции:**
   - Наблюдается увеличение среднего размера чаевых с увеличением дистанции поездки для большинства групп пассажиров.
   - Группы с нулевым количеством пассажиров (0) имеют разнообразные средние чаевые в зависимости от длины поездки.

2. **Группа пассажиров с нулевым количеством (0):**
   - В среднем, чаевые увеличиваются с увеличением длины поездки.
   - Интересное явление в группе с длиной поездки 50-60: средние чаевые заметно выше, чем в соседних интервалах.

3. **Группа пассажиров с одним (1) пассажиром:**
   - Средние чаевые также растут с увеличением длины поездки.
   - Особенно высокие средние чаевые в группе с 80-90 миль длиной поездки.

4. **Группа пассажиров с двумя (2) пассажирами:**
   - Выраженный рост средних чаевых в группе с более чем 100 миль длиной поездки.

5. **Группа пассажиров с тремя (3) и более пассажирами:**
   - Заметное увеличение средних чаевых в группах с 60-70 и 70-80 милями длины поездки.

6. **Общий вывод:**
   - Пассажиры, заказывающие такси для длительных поездок, склонны оставлять более значительные чаевые.
   - Наблюдаются интересные аномалии, например, высокие средние чаевые в группе с нулевым количеством пассажиров при длине поездки 50-60 миль.
   - Рекомендуется более детальное исследование данных, чтобы понять факторы, влияющие на размер чаевых в различных сценариях поездок.

### Выводы на основе данных из таблицы `percentage_max_min_data`:

1. **Без пассажиров:**
   - Процент поездок без пассажиров варьируется от 0% до 1.94%, с минимальной стоимостью 0.3 и максимальной 4,268.3.

2. **С одним пассажиром:**
   - Процент поездок с одним пассажиром колеблется от 58.73% до 74.74%, с минимальной стоимостью 3.3 и максимальной 4,268.3.

3. **С двумя пассажирами:**
   - Процент поездок с двумя пассажирами изменяется от 13.32% до 19.54%, с минимальной стоимостью 0.3 и максимальной 617.3.

4. **С тремя пассажирами:**
   - Процент поездок с тремя пассажирами варьируется от 3.29% до 5.95%, с минимальной стоимостью 0.3 и максимальной 5.75.

5. **С четырьмя и более пассажирами:**
   - Процент поездок с четырьмя и более пассажирами достигает до 22.22%, с минимальной стоимостью 0.3 и максимальной 7,436.4.

6. **Общий вывод:**
- Существует значительный разброс в проценте поездок и стоимости в зависимости от количества пассажиров.
- Наблюдаются аномалии, такие как высокие стоимости поездок с одним пассажиром и нулевым процентом поездок без пассажиров в нескольких случаях.
- Необходимо более детальное исследование для понимания факторов, влияющих на эти аномалии, и корректировки данных при необходимости.

---
